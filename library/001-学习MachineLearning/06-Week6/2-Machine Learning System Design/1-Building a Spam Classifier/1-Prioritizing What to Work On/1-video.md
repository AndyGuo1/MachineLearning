# 机器学习系统设计-优先做什么
## 视频
<video height=510 width=900 controls="controls" preload="none">
      <source src="amWiki/videos/001/06-Week6/2-Machine Learning System Design/1-Prioritizing What to Work On.mp4" type="video/mp4">
</video>
## 中文
### 邮件分类问题
![邮件分类问题](amWiki/images/001/06-Week6/2-Machine Learning System Design\1-邮件分类问题.jpg)  
在接下来的视频中 我将谈到机器学习系统的设计 这些视频将谈及 在设计复杂的机器学习系统时 你将遇到的 主要问题 同时我们会试着 给出一些关于 如何巧妙构建一个复杂的机器学习系统的建议 接下来的视频 可能看起来 有点不连贯 因为这些视频会涉及 一些你在设计机器学习系统时 可能会遇到的不同问题 虽然 下面的课程的 的数学性可能不是那么强 但是我认为我们将要讲到的这些东西 是非常有用的 可能在构建大型的机器学习系统时 节省大量的时间 具体的说 我首先要讲的是 当我们在进行机器学习时 着重要考虑什么问题 首先我要举一个 垃圾邮件分类的例子假如你想建立一个垃圾邮件分类器 看这些垃圾邮件与 非垃圾邮件的例子 左边这封邮件想向你推销东西 注意 这封垃圾邮件 有意的拼错一些单词 就像 "Med1cine" 中有一个1 "m0rtgage"里有个0 右边的邮件 显然不是一个垃圾邮件 实际上这是我弟弟写给我的 假设我们已经有一些 加过标签的训练集 包括标注的垃圾邮件 表示为y=1 和非垃圾邮件 表示为y=0
### 构建垃圾邮件分类器
![构建垃圾邮件分类器](amWiki/images/001/06-Week6/2-Machine Learning System Design\2-构建垃圾邮件分类器.jpg)  
我们如何 以监督学习的方法来构造一个分类器 来区分垃圾邮件和非垃圾邮件呢？为了应用监督学习 我们首先 必须确定的是 如何用邮件的特征 构造向量x 给出训练集中的 特征x和标签y 我们就能够训练出某种分类器 比如用逻辑回归的方法 这里有一种选择 邮件的一些特征变量的方法 比如说我们可能会想出 一系列单词 或者成百上千的单词 我们可以认为这些单词 能够用来区分垃圾邮件或非垃圾邮件 比如说 如果有封邮件 包含单词"deal(交易)" 那么它就很有可能是一封垃圾邮件 同时 包含单词"buy(买)"的邮件 也很有可能是一封垃圾邮件 包含"discount(折扣)"的邮件 也很有可能是垃圾邮件 如果一封邮件中 包含了我的名字"Andrew" 这有可能是一个知道我的人写的 这说明这封邮件 不太可能是垃圾邮件 因为某些原因 我认为 "now(现在)"这个单词表明了 这封邮件可能并不是垃圾邮件 因为我经常收到一些很紧急的邮件 当然还有别的单词 我们可以选出这样成百上千的单词 给出一封这样的邮件 我们可以将这封邮件 用一个特征向量 来表示 方法如下 现在我列出一些 之前选好的单词 然后按字典序排序 其实并不是一定要排序的啦 你看 这些是之前的单词 像“discount” 等等 还有单词"now" 等等 看看这个例子 右边的这封邮件 我准备 检查一下这些词汇 看它们是否 出现在这封邮件中 我用一个 特征向量x 表示右边的这封邮件 我的名字没有出现 因此这里是0 单词"buy(购买)"出现了 所以这里是1 注意在向量里面只有1或0 表示有没有出现 所以尽管"buy"出现了两次 这里仍然只是1 注意我不会去统计每个词出现的次数 单词"deal"也出现了 所以这里也是1 单词"discount"并没有出现 至少在这封邮件里是这样 以此类推 单词"now"出现了 所以我在特征向量中 依据对应的单词是否出现 填上0和1 在这个例子中 因为我选择了100个单词 用于表示是否可能为垃圾邮件 所以 这个特征向量x 的维度是100 并且 如果这个特定的单词 即单词 j 出现在 这封邮件中 那么每一个特征变量 Xj 的值为1 反之 Xj为0 好 这样我们就可以使用特征向量 来表示这封邮件 顺便说一句 虽然我所描述的这个过程是我自己 选取的100个单词 但是在实际工作中 最普遍的做法是 遍历整个训练集 然后 在训练集中 选出出现次数最多的n个单词 n一般介于10,000和50,000之间 然后把这些单词 作为你要用的特征 因此不同于手动选取 我们只用遍历 训练样本 然后选出出现频率最高的词语 差不多是10,000到50,000个单词 这些单词会构成特征 这样你就可以用它们 来做垃圾邮件分类
### 改进垃圾邮件分类器误差的方法
![改进垃圾邮件分类器误差的方法](amWiki/images/001/06-Week6/2-Machine Learning System Design\3-改进垃圾邮件分类器误差的方法.jpg)  
如果你正在构造一个垃圾邮件分类器 你应该会面对这样一个问题 那就是 你最该去使用哪一种 改进你的方法 从而使得你的垃圾邮件分类器具有较高的准确度 从直觉上讲 是要收集大量的数据 生成了这个叫做 data 的对象 是吧？ 事实上确实好多人这么做 很多人认为 收集越多的数据 算法就会表现的越好 事实上 就垃圾邮件分类而言 有一个叫做"Honey Pot"的项目 它可以建立一个 假的邮箱地址 故意将这些地址 泄露给发垃圾邮件的人 这样就能收到大量的垃圾邮件 你看 这样的话 我们就能得到非常多的垃圾邮件来训练学习算法 但是 在前面的课程中我们知道 大量的数据可能会有帮助 也可能没有 对于大部分的机器学习问题 还有很多办法 用来提升机器学习的效果 比如对于垃圾邮件而言 也许你会想到 用更复杂的特征变量 像是邮件的路径信息 这种信息通常会出现在邮件的标题中 因此 垃圾邮件发送方在发送垃圾邮件时 他们总会试图 让这个邮件的来源变得模糊一些 或者是 用假的邮件标题 或者通过不常见的服务器 来发送邮件 用不常见的路由 他们就能给你发送垃圾邮件 而且这些信息也有可能包含在邮件标题部分 因此可以想到
我们可以通过邮件的标题部分 来构造更加复杂的特征 来获得一系列的邮件路由信息 进而判定这是否是一封垃圾邮件 你还可能会想到别的方法 比如 从邮件的正文出发 寻找一些复杂点的特征 例如 单词"discount" 是否和单词"discounts"是一样的 又比如 单词"deal(交易)"和"dealer(交易商)"是否也应视为等同 甚至 像这个例子中 有的单词小写有的大写 或者我们是否应该用标点符号来构造复杂的特征变量 因为垃圾邮件可能会更多的使用感叹号 这些都不一定 同样的 我们也可能构造 更加复杂的算法来检测 或者纠正那些故意的拼写错误 例如 "m0rtgage" "med1cine" "w4tches" 因为垃圾邮件发送方确实这么做了 因为如果你将4放到"w4tches"中 那么 用我们之前提到的 简单的方法 垃圾邮件分类器不会把"w4tches" 和"watches" 看成一样的 这样我们就很难区分这些 故意拼错的垃圾邮件 发垃圾邮件的也很机智 他们这么做就逃避了一些过滤 当我们使用机器学习时 总是可以“头脑风暴”一下 想出一堆方法来试试 就像这样 顺带一提 我有一段时间 研究过垃圾邮件分类的问题 实际上我花了很多时间来研究这个 尽管我能够理解 垃圾邮件分类的问题 我确实懂一些这方面的东西 但是 我还是很难告诉你 这四种方法中 你最该去使用哪一种 事实上 坦白地说 最常见的情况是 一个研究小组 可能会随机确定其中的一个方法 但是有时候 这种方法 并不是最有成效的 你知道 你只是随机选择了其中的一种方法 实际上 当你需要通过 头脑风暴来想出 不同方法来尝试去提高精度的时候 你可能已经超越了很多人了 令人难过的是 大部分人 他们并不尝试着 列出可能的方法 他们做的 只是 某天早上醒来 因为某些原因 有了一个突发奇想 "让我们来试试 用Honey Pot项目 收集大量的数据吧" 不管出于什么奇怪的原因 早上的灵机一动 还是随机选一个 然后干上大半年 但是我觉得我们有更好的方法 是的 我们将在随后的课程中 讲到这个 那就是误差分析 我会告诉你 怎样用一个 更加系统性的方法 从一堆不同的方法中 选取合适的那一个 因此 你更有可能选择 一个真正的好方法 能让你花上几天几周 甚至是几个月 去进行深入的研究
### 内置习题
![内置习题_理解改进垃圾邮件分类器的几种方式](amWiki/images/001/06-Week6/2-Machine Learning System Design/4-内置习题_理解改进垃圾邮件分类器的几种方式.jpg)  
## English
### The problem of spam classification
![The problem of spam classification](amWiki/images/001/06-Week6/2-Machine Learning System Design\1-邮件分类问题.jpg)  
In the next few videos I'd like to talk about machine learning system design.These videos will touch on the main issues that you may face when designing a complex machine learning system,and will actually try to give advice on how to strategize putting together a complex machine learning system.In case this next set of videos seems a little disjointed that's because these videos will touch on a range of the different issues that you may come across when designing complex learning systems.And even though the next set of videos may seem somewhat less mathematical, I think that this material may turn out to be very useful, and potentially huge time savers when you're building big machine learning systems.Concretely, I'd like to begin with the issue of prioritizing how to spend your time on what to work on, and I'll begin with an example on spam classification.Let's say you want to build a spam classifier.Here are a couple of examples of obvious spam and non-spam emails.
if the one on the left tried to sell things. And notice how spammers will deliberately misspell words, like Vincent with a 1 there, and mortgages.And on the right as maybe an obvious example of non-stamp email, actually email from my younger brother.Let's say we have a labeled training set of some number of spam emails and some non-spam emails denoted with labels y equals 1 or 0.
### Build a spam classifier using supervised learning
![Build a classifier using supervised learning](amWiki/images/001/06-Week6/2-Machine Learning System Design\2-构建垃圾邮件分类器.jpg)  
How do we build a classifier using supervised learning to distinguish between spam and non-spam?In order to apply supervised learning, the first decision we must make is how do we want to represent x, that is the features of the email. Given the features x and the labels y in our training set, we can then train a classifier, for example using logistic regression.Here's one way to choose a set of features for our emails.
We could come up with, say, a list of maybe a hundred words that we think are indicative of whether e-mail is spam or non-spam, for example, if a piece of e-mail contains the word 'deal' maybe it's more likely to be spam if it contains the word 'buy' maybe more likely to be spam, a word like 'discount' is more likely to be spam, whereas if a piece of email contains my name,Andrew, maybe that means the person actually knows who I am and that might mean it's less likely to be spam.And maybe for some reason I think the word "now" may be indicative of non-spam because I get a lot of urgent emails, and so on, and maybe we choose a hundred words or so.Given a piece of email, we can then take this piece of email and encode it into a feature vector as follows. I'm going to take my list of a hundred words and sort them in alphabetical order say. It doesn't have to be sorted. But, you know, here's a, here's my list of words, just count and so on, until eventually I'll get down to now, and so on and given a piece of e-mail like that shown on the right, I'm going to check and see whether or not each of these words appears in the e-mail and then I'm going to define a feature vector x where in this piece of an email on the right, my name doesn't appear so I'm gonna put a zero there. The word "by" does appear,so I'm gonna put a one there and I'm just gonna put one's or zeroes. I'm gonna put a one even though the word "by" occurs twice. I'm not gonna recount how many times the word occurs.The word "due" appears, I put a one there. The word "discount" doesn't appear, at least not in this this little short email, and so on. The word "now" does appear and so on. So I put ones and zeroes in this feature vector depending on whether or not a particular word appears. And in this example my feature vector would have to mention one hundred,
if I have a hundred, if if I chose a hundred words to use for this representation and each of my features Xj will basically be 1 if you have a particular word that, we'll call this word j, appears in the email and Xj would be zero otherwise. Okay. So that gives me a feature representation of a piece of email. By the way, even though I've described this process as manually picking a hundred words, in practice what's most commonly done is to look through a training set, and in the training set depict the most frequently occurring n words where n is usually between ten thousand and fifty thousand, and use those as your features. So rather than manually picking a hundred words, here you look through the training examples and pick the most frequently occurring words like ten thousand to fifty thousand words, and those form the features that you are going to use to represent your email for spam classification.
### Ways to impove the accuracy of spam classifier
![Ways to impove the accuracy of spam classifier](amWiki/images/001/06-Week6/2-Machine Learning System Design\3-改进垃圾邮件分类器误差的方法.jpg)  
Now, if you're building a spam classifier one question that you may face is, what's the best use of your time in order to make your spam classifier have higher accuracy, you have lower error.One natural inclination is going to collect lots of data. Right? And in fact there's this tendency to think that, well the more data we have the better the algorithm will do. And in fact, in the email spam domain, there are actually pretty serious projects called Honey Pot Projects, which create fake email addresses and try to get these fake email addresses into the hands of spammers and use that to try to collect tons of spam email, and therefore you know, get a lot of spam data to train learning algorithms. But we've already seen in the previous sets of videos that getting lots of data will often help, but not all the time.But for most machine learning problems, there are a lot of other things you could usually imagine doing to improve performance.For spam, one thing you might think of is to develop more sophisticated features on the email, maybe based on the email routing information.And this would be information contained in the email header.So, when spammers send email, very often they will try to obscure the origins of the email, and maybe use fake email headers.Or send email through very unusual sets of computer service. Through very unusual routes, in order to get the spam to you. And some of this information will be reflected in the email header.And so one can imagine,looking at the email headers and trying to develop more sophisticated features to capture this sort of email routing information to identify if something is spam. Something else you might consider doing is to look at the email message body, that is the email text, and try to develop more sophisticated features. For example, should the word 'discount' and the word 'discounts' be treated as the same words or should we have treat the words 'deal' and 'dealer' as the same word? Maybe even though one is lower case and one in capitalized in this example. Or do we want more complex features about punctuation because maybe spam is using exclamation marks a lot more. I don't know. And along the same lines, maybe we also want to develop more sophisticated algorithms to detect and maybe to correct to deliberate misspellings, like mortgage, medicine, watches.Because spammers actually do this, because if you have watches with a 4 in there then well, with the simple technique that we talked about just now, the spam classifier might not equate this as the same thing as the word "watches," and so it may have a harder time realizing that something is spam with these deliberate misspellings. And this is why spammers do it.While working on a machine learning problem, very often you can brainstorm lists of different things to try, like these. By the way, I've actually worked on the spam problem myself for a while. And I actually spent quite some time on it. And even though I kind of understand the spam problem, I actually know a bit about it, I would actually have a very hard time telling you of these four options which is the best use of your time so what happens, frankly what happens far too often is that a research group or product group will randomly fixate on one of these options. And sometimes that turns out not to be the most fruitful way to spend your time depending, you know, on which of these options someone ends up randomly fixating on. By the way, in fact, if you even get to the stage where you brainstorm a list of different options to try, you're probably already ahead of the curve. Sadly, what most people do is instead of trying to list out the options of things you might try, what far too many people do is wake up one morning and, for some reason, just, you know, have a weird gut feeling that, "Oh let's have a huge honeypot project to go and collect tons more data" and for whatever strange reason just sort of wake up one morning and randomly fixate on one thing and just work on that for six months.But I think we can do better. And in particular what I'd like to do in the next video is tell you about the concept of error analysis and talk about the way where you can try to have a more systematic way to choose amongst the options of the many different things you might work, and therefore be more likely to select what is actually a good way to spend your time, you know for the next few weeks, or next few days or the next few months.
### Exam_in the video
![Exam_Understand the ways to impove the accuracy of spam classifier](amWiki/images/001/06-Week6/2-Machine Learning System Design/4-内置习题_理解改进垃圾邮件分类器的几种方式.jpg)  
